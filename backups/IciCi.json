{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Set",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set": {
      "main": [
        [
          {
            "node": "Function",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function": {
      "main": [
        [
          {
            "node": "IF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2023-09-11T09:44:51.714Z",
  "id": "356",
  "name": "IciCi",
  "nodes": [
    {
      "parameters": {},
      "name": "Start",
      "type": "n8n-nodes-base.start",
      "typeVersion": 1,
      "position": [
        20,
        320
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "icici-send-mail",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        280,
        260
      ],
      "webhookId": "76035231-b7e7-4b11-a5ab-15405fb3a076"
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "value": "={{$node[\"Webhook\"].json[\"body\"]}}"
            }
          ]
        },
        "options": {}
      },
      "name": "Set",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        500,
        260
      ]
    },
    {
      "parameters": {
        "fromEmail": "order-update@shakepe.com",
        "toEmail": "={{$node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"to\"]}}",
        "subject": "={{$node[\"Function\"].json[\"mailSubject\"]}}",
        "html": "={{$node[\"Function\"].json[\"mailText\"]}}",
        "options": {}
      },
      "name": "Send Email",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 1,
      "position": [
        1240,
        460
      ],
      "credentials": {
        "smtp": {
          "id": "7",
          "name": "AWS SES Creds"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "let mailCase = $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"case\"];\nlet mailText = \"\";\nlet mailSubject = \"\";\nlet mail_format = $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"email_format\"];\n\nlet total_value = 0;\nlet no_of_codes = \"\";\nlet no_of_code_values = \"\";\nlet catalogue_type = \"Customized\";\nif(mail_format != 'new'){\n  mail_format = 'old';\n}else{\n  let np_of_links =  $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"links_config\"];\n\n  let link_values = [];\n  let link_codes = [];\n\n  if(np_of_links){\n    np_of_links.forEach(obj => {\n      link_values.push(parseInt(obj[\"Total Codes\"]));\n      let total_value = obj[\"Value\"].replace(/\\s/g,'');\n      link_codes.push(parseInt(total_value.replace(\"₹\",\"\")));\n    });\n    link_values = link_values.slice(0,-1);\n    link_codes = link_codes.slice(0,-1);\n  }\n\n  total_value = $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_value\"];\n  if(total_value){\n      total_value = total_value.replace(/\\s/g,'').replace(\"₹\",\"\");\n  }\n  no_of_codes = link_values.join(',');\n  no_of_code_values = link_codes.join(',');\n\n  let catalogue = $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_catalogue_type\"];\n  if(catalogue == \"standard\"){\n    catalogue_type = \"Standardized\";\n  }\n}\nlet approver_content = 'You have received a new request to approve the set of reward links created by {requester_name}.';\nlet admin_content = 'We are writing to inform you that the reward link request, previously approved by {approver_name}, is now awaiting your final approval.';\n\nconst opsEmailAddresses = [\"surya.kc+ops@shakedeal.com\"];\nlet mail_content = '<!DOCTYPE html><head><title>Email Notification</title><style type=\"text/css\">.main-content{width:600px;position:relative;background-color:#fff;border:1px solid #e6e6e6;padding:0 44px 0 46px;text-align:left}.content-table{width:100%;height:100%;font-family:system-ui;text-align:left}.print-width100{width:100%}a:link{text-decoration:none}a:visited{text-decoration:none}a:hover{text-decoration:none}a:active{text-decoration:none}.heading-text{font-size:30px;color:#73bf50;font-weight:600;font-family:system-ui;text-align:center}.content-text{font-size:16px;color:#666;font-weight:400;font-family:system-ui}.footer-text{font-size:16px;color:#4e6db5;font-weight:400;text-align:center;vertical-align:middle;font-family:system-ui}.table-body{border:1px solid #d3d7e3}.table-col-head{font-size:14px;color:#28539b;font-weight:600;width:30%}.table-col-val{font-size:14px;color:#505050;font-weight:400}.footer{padding:20px;border-top:1px solid #aebbdd;background-color:#f8fafe;border-radius:0 0 10px 10px}</style></head><body><div class=\"main-content\"><div><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tbody><tr><th colspan=\"3\" style=\"text-align:center\"><img src=\"https://cdn.shakedeal.com/images/logos/2/shakepe_logo.png\" style=\"width:20%;padding:20px\"></th></tr></tbody></table><table class=\"print-width100\"><tbody><tr><th><div style=\"border:1px solid #aebbdd;border-radius:10px\"><div class=\"content\" style=\"padding:20px\"><div><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px\"><tbody><tr><th class=\"heading-text\">New Campaign Creation</th></tr></tbody></table><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px;padding-top:30px\"><tbody><tr><th class=\"content-text\" style=\"font-weight:600\">Dear {approver_name},</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">{approver_content}</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">Kindly review the details provided below:</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\" style=\"font-weight:600\">Request Details:</th></tr></tbody></table></div><div style=\"padding-top:20px;padding-left:5px\"><table class=\"content-table voucher-table\" cellpadding=\"10\" cellspacing=\"0\"><tbody><tr><th class=\"table-body table-col-head\" style=\"border-radius:10px 0 0 0\">Campaign Name</th><th class=\"table-body table-col-val\" style=\"border-radius:0 10px 0 0\">{campaign_name}</th></tr><tr><th class=\"table-body table-col-head\">Duration</th><th class=\"table-body table-col-val\">{campaign_duration}</th></tr><tr><th class=\"table-body table-col-head\">Catalogue</th><th class=\"table-body table-col-val\">{catalogue}</th></tr><tr><th class=\"table-body table-col-head\">Quantity</th><th class=\"table-body table-col-val\">{quantity}</th></tr><tr><th class=\"table-body table-col-head\">Value of each link</th><th class=\"table-body table-col-val\">{value}</th></tr><tr><th class=\"table-body table-col-head\" style=\"border-radius:0 0 0 10px\">Campaign Value</th><th class=\"table-body table-col-val\" style=\"border-radius:0 0 10px 0\">₹ {campaign_value}</th></tr></tbody></table></div><div style=\"padding-top:30px\"><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px\"><tbody><tr><th class=\"content-text\">To take action on this request, please log in to the portal using the following link: <a href=\"{url}\">{url}</a>.</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">Your prompt attention to this matter would be greatly appreciated.</th></tr></tbody></table></div><div style=\"padding-top:30px\"><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px\"><tbody><tr><th class=\"content-text\">Best regards,</th></tr><tr><th class=\"content-text\">Team ShakePe</th></tr></tbody></table></div></div><div class=\"footer\"><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px;background-color:#f8fafe\"><tbody><tr style=\"width:100%\"><th class=\"footer-text\">Need any<br><span style=\"font-weight:700\">ASSISTANCE?</span></th><th class=\"footer-text\">EMAIL<br><a href=\"mailto:support@shakepe.com\"><span style=\"color:#5fbd57\">support@shakepe.com</span></a></th><th class=\"footer-text\">CALL<br><a href=\"tel:+916366532173\"><span style=\"color:#4e6db5;font-weight:700\">+91-6366532173</span></a></th></tr></tbody></table></div></div></th></tr></tbody></table><br><br><br></div></div></body>';\nlet reject_mail_content = '<!DOCTYPE html><head><title>Email Notification</title><style type=\"text/css\">.main-content{width:600px;position:relative;background-color:#fff;border:1px solid #e6e6e6;padding:0 44px 0 46px;text-align:left}.content-table{width:100%;height:100%;font-family:system-ui;text-align:left}.print-width100{width:100%}a:link{text-decoration:none}a:visited{text-decoration:none}a:hover{text-decoration:none}a:active{text-decoration:none}.heading-text{font-size:30px;color:#73bf50;font-weight:600;font-family:system-ui;text-align:center}.content-text{font-size:16px;color:#666;font-weight:400;font-family:system-ui}.footer-text{font-size:16px;color:#4e6db5;font-weight:400;text-align:center;vertical-align:middle;font-family:system-ui}.table-body{border:1px solid #d3d7e3}.table-col-head{font-size:14px;color:#28539b;font-weight:600;width:30%}.table-col-val{font-size:14px;color:#505050;font-weight:400}.footer{padding:20px;border-top:1px solid #aebbdd;background-color:#f8fafe;border-radius:0 0 10px 10px}</style></head><body><div class=\"main-content\"><div><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tbody><tr><th colspan=\"3\" style=\"text-align:center\"><img src=\"https://cdn.shakedeal.com/images/logos/2/shakepe_logo.png\" style=\"width:20%;padding:20px\"></th></tr></tbody></table><table class=\"print-width100\"><tbody><tr><th><div style=\"border:1px solid #aebbdd;border-radius:10px\"><div class=\"content\" style=\"padding:20px\"><div><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px\"><tbody><tr><th class=\"heading-text\">Decline of Campaign Request</th></tr></tbody></table><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px;padding-top:30px\"><tbody><tr><th class=\"content-text\" style=\"font-weight:600\">Dear {requester_name},</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">Your campaign request for {campaign_name} has been declined by {approver_name}.</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">Comments: {comments}</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">If you have any questions or would like to discuss the feedback in more detail, please contact {approver_name}.</th></tr></tbody></table></div><div style=\"padding-top:30px\"><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px\"><tbody><tr><th class=\"content-text\">Best regards,</th></tr><tr><th class=\"content-text\">Team ShakePe</th></tr></tbody></table></div></div><div class=\"footer\"><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px;background-color:#f8fafe\"><tbody><tr style=\"width:100%\"><th class=\"footer-text\">Need any<br><span style=\"font-weight:700\">ASSISTANCE?</span></th><th class=\"footer-text\">EMAIL<br><a href=\"mailto:support@shakepe.com\"><span style=\"color:#5fbd57\">support@shakepe.com</span></a></th><th class=\"footer-text\">CALL<br><a href=\"tel:+916366532173\"><span style=\"color:#4e6db5;font-weight:700\">+91-6366532173</span></a></th></tr></tbody></table></div></div></th></tr></tbody></table><br><br><br></div></div></body>';\nswitch(mailCase){\n  case 1:\n    mailText = `Dear ${$node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"approver_name\"]},<br><br>`+\n    `You have received a new request to approve the set of codes that have been created by the ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name}<br><br>`+\n    `Kindly review the details provided below:<br><br>`+\n    `Request Details:<br>`+\n    `${$node[\"Webhook\"].json[\"body\"][\"table_html\"]}<br>`+\n    `Requestor's Name: ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name}<br>`+\n    `Total Codes: ${$node[\"Webhook\"].json.body.trigger.body.config.links_count}<br>`+\n    `Total Value: ${$node[\"Webhook\"].json.body.trigger.body.config.campaign_value}<br><br>`+\n    `To take action on this request, please log in to the portal using the following link: ${$node[\"Webhook\"].json.body.trigger.body.config.request_link}<br><br>`+\n    `Your prompt attention to this matter would be greatly appreciated.<br><br>`+\n    `Best regards,<br><br>`+\n    `Team ShakePe`;\n    \n    if(mail_format == 'new'){\n      approver_content = approver_content.replace(/{requester_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"requester_name\"])\n      mail_content = mail_content.replace(/{url}/g, $node[\"Webhook\"].json.body.trigger.body.config.request_link)\n                .replace(/{approver_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"approver_name\"])\n                .replace(/{requester_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"requester_name\"])\n                .replace(/{campaign_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_name\"])\n                .replace(/{catalogue}/g, catalogue_type)\n                .replace(/{campaign_duration}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_duration\"])\n                .replace(/{quantity}/g, no_of_codes)\n                .replace(/{value}/g, no_of_code_values)\n                .replace(/{approver_content}/g, approver_content)\n                .replace(/{campaign_value}/g, total_value);\n\n      mailText = mail_content;\n    }\n\n    mailSubject = \"Action Required: Codes Approval Request\"+` (${$node[\"Webhook\"].json.body.trigger.body.config.request_id})`;\n    break;\n  case 2:\n    mailText = `Dear ${$node[\"Webhook\"].json.body.trigger.body.config.admin_name},<br><br>`+\n    `We are writing to inform you that the codes request, which was previously reviewed and approved by ${$node[\"Webhook\"].json.body.trigger.body.config.approver_name} , is now awaiting your final approval.<br><br>`+ \n    `Kindly review the details provided below:<br><br>`+\n    `Request Details:<br>`+\n    `${$node[\"Webhook\"].json[\"body\"][\"table_html\"]}<br>`+\n    `Requestor's Name: ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name}<br> `+\n    `Total Codes: ${$node[\"Webhook\"].json.body.trigger.body.config.links_count}<br>`+\n    `Total Value: ${$node[\"Webhook\"].json.body.trigger.body.config.campaign_value}<br>`+\n    `Approver’s Name: ${$node[\"Webhook\"].json.body.trigger.body.config.approver_name}<br><br>`+\n    `To take action on this request, please log in to the portal using the following link: ${$node[\"Webhook\"].json.body.trigger.body.config.request_link}<br><br>`+\n    `Your prompt attention to this matter would be greatly appreciated.<br><br>`+\n    `Best regards,<br><br>`+\n    `Team ShakePe`\n\n    if(mail_format == 'new'){\n      admin_content = admin_content.replace(/{approver_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"approver_name\"])\n      mail_content = mail_content.replace(/{url}/g, $node[\"Webhook\"].json.body.trigger.body.config.request_link)\n                .replace(/{approver_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"admin_name\"])\n                .replace(/{requester_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"requester_name\"])\n                .replace(/{campaign_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_name\"])\n                .replace(/{catalogue}/g, catalogue_type)\n                .replace(/{campaign_duration}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_duration\"])\n                .replace(/{quantity}/g, no_of_codes)\n                .replace(/{value}/g, no_of_code_values)\n                .replace(/{approver_content}/g, admin_content)\n                .replace(/{campaign_value}/g, total_value);\n\n      mailText = mail_content;\n    }\n    mailSubject=\"Action Required: Codes Approval Request - Final Approval\"+` (${$node[\"Webhook\"].json.body.trigger.body.config.request_id})`;\n    break;\n  case 3:\n    let admins_count = $node[\"Webhook\"].json.body.trigger.body.config.admins_count;\n    mailText= `Dear ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name},<br><br>`+\n    `Your request (${$node[\"Webhook\"].json.body.trigger.body.config.request_id}) has been reviewed and approved by ${$node[\"Webhook\"].json.body.trigger.body.config.approver_name} and now your request is pending final approval from the admin${admins_count > 1 ? '(s)' : ''}, ${$node[\"Webhook\"].json.body.trigger.body.config.admin_name}.<br><br>`+\n    `We will keep you informed of any updates and actions taken by the admin.<br><br>`+\n    `Best regards,<br><br>`+\n    `Team ShakePe`\n\n    if(mail_format == 'new'){\n      let admin_count = `admin${admins_count > 1 ? '(s)' : ''}`;\n      mail_content = '<!DOCTYPE html><head><title>Email Notification</title><style type=\"text/css\">.main-content{width:600px;position:relative;background-color:#fff;border:1px solid #e6e6e6;padding:0 44px 0 46px;text-align:left}.content-table{width:100%;height:100%;font-family:system-ui;text-align:left}.print-width100{width:100%}a:link{text-decoration:none}a:visited{text-decoration:none}a:hover{text-decoration:none}a:active{text-decoration:none}.heading-text{font-size:30px;color:#73bf50;font-weight:600;font-family:system-ui;text-align:center}.content-text{font-size:16px;color:#666;font-weight:400;font-family:system-ui}.footer-text{font-size:16px;color:#4e6db5;font-weight:400;text-align:center;vertical-align:middle;font-family:system-ui}.table-body{border:1px solid #d3d7e3}.table-col-head{font-size:14px;color:#28539b;font-weight:600;width:30%}.table-col-val{font-size:14px;color:#505050;font-weight:400}.footer{padding:20px;border-top:1px solid #aebbdd;background-color:#f8fafe;border-radius:0 0 10px 10px}</style></head><body><div class=\"main-content\"><div><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tbody><tr><th colspan=\"3\" style=\"text-align:center\"><img src=\"https://cdn.shakedeal.com/images/logos/2/shakepe_logo.png\" style=\"width:20%;padding:20px\"></th></tr></tbody></table><table class=\"print-width100\"><tbody><tr><th><div style=\"border:1px solid #aebbdd;border-radius:10px\"><div class=\"content\" style=\"padding:20px\"><div><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px\"><tbody><tr><th class=\"heading-text\">Update On Your Campaign Request</th></tr></tbody></table><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px;padding-top:30px\"><tbody><tr><th class=\"content-text\" style=\"font-weight:600\">Dear {requester_name},</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">Your campaign request for {campaign_name} has been approved by {approver_name}, and now your request is pending final approval from {admin_count}, {admin_name}.</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">We will keep you informed of any updates and actions the admin takes.</th></tr></tbody></table></div><div style=\"padding-top:30px\"><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px\"><tbody><tr><th class=\"content-text\">Best regards,</th></tr><tr><th class=\"content-text\">Team ShakePe</th></tr></tbody></table></div></div><div class=\"footer\"><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px;background-color:#f8fafe\"><tbody><tr style=\"width:100%\"><th class=\"footer-text\">Need any<br><span style=\"font-weight:700\">ASSISTANCE?</span></th><th class=\"footer-text\">EMAIL<br><a href=\"mailto:support@shakepe.com\"><span style=\"color:#5fbd57\">support@shakepe.com</span></a></th><th class=\"footer-text\">CALL<br><a href=\"tel:+916366532173\"><span style=\"color:#4e6db5;font-weight:700\">+91-6366532173</span></a></th></tr></tbody></table></div></div></th></tr></tbody></table><br><br><br></div></div></body>';\n      mail_content = mail_content.replace(/{approver_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"approver_name\"])\n                .replace(/{requester_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"requester_name\"])\n                .replace(/{campaign_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_name\"])\n                .replace(/{admin_count}/g, admin_count)\n                .replace(/{admin_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"admin_name\"]);\n\n      mailText = mail_content;\n    }\n    mailSubject= `Update on Your Codes Request (${$node[\"Webhook\"].json.body.trigger.body.config.request_id})`\n    break;\n  case 4:\n    mailText=`Dear ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name},<br><br>`+\n    `We regret to inform you that your request has been reviewed by ${$node[\"Webhook\"].json.body.trigger.body.config.approver_name}, and unfortunately, it has been declined.<br><br>`+\n    `Comments: ${$node[\"Webhook\"].json.body.trigger.body.config.approver_comments}<br><br>`+\n    `If you have any questions or would like to discuss the feedback in more detail, please reach out to the ${$node[\"Webhook\"].json.body.trigger.body.config.approver_name}.<br><br>` +\n    `Best regards,<br><br>`+\n\n    `Team ShakePe`\n\n    if(mail_format == 'new'){\n      reject_mail_content = reject_mail_content.replace(/{approver_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"approver_name\"])\n                .replace(/{requester_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"requester_name\"])\n                .replace(/{campaign_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_name\"])\n                .replace(/{comments}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"approver_comments\"]);\n\n      mailText = reject_mail_content;\n    }\n    mailSubject=`Decline of New Codes Request (${$node[\"Webhook\"].json.body.trigger.body.config.request_id})`\n    break;\n  case 5:\n    let ops_mail_required = $node[\"Webhook\"].json.body.trigger.body.config.ops_mail_required;\n\n    if(ops_mail_required == true){\n      mailText = `Dear ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name},<br><br>`+\n      `Your codes request has been reviewed and approved by the admin, ${$node[\"Webhook\"].json.body.trigger.body.config.admin_name}. The campaign requires a final confirmation from the Ops Team.<br><br>`+\n      `Upon Ops Approval, you can access the codes through the portal<br>`+\n      `${$node[\"Webhook\"].json.body.trigger.body.config.request_link}<br><br>`+\n      `Post which you can download the reward links and send them across to the intended recipients to recognize and motivate them for their outstanding contributions, efforts, or achievements.<br><br>`+\n      `Best regards,<br><br>`+\n      `Team ShakePe`\n    }else{\n      mailText = `Dear ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name},<br><br>`+\n      `Your codes request has been reviewed and approved by the admin, ${$node[\"Webhook\"].json.body.trigger.body.config.admin_name}.<br><br>`+\n      `You can access the codes through the portal<br>`+\n      `${$node[\"Webhook\"].json.body.trigger.body.config.request_link}<br><br>`+\n      `Post which you can download the reward links and send them across to the intended recipients to recognize and motivate them for their outstanding contributions, efforts, or achievements.<br><br>`+\n      `Best regards,<br><br>`+\n      `Team ShakePe`\n\n      if(mail_format == 'new'){\n        mail_content = '<!DOCTYPE html><head><title>Email Notification</title><style type=\"text/css\">.main-content{width:600px;position:relative;background-color:#fff;border:1px solid #e6e6e6;padding:0 44px 0 46px;text-align:left}.content-table{width:100%;height:100%;font-family:system-ui;text-align:left}.print-width100{width:100%}a:link{text-decoration:none}a:visited{text-decoration:none}a:hover{text-decoration:none}a:active{text-decoration:none}.heading-text{font-size:30px;color:#73bf50;font-weight:600;font-family:system-ui;text-align:center}.content-text{font-size:16px;color:#666;font-weight:400;font-family:system-ui}.footer-text{font-size:16px;color:#4e6db5;font-weight:400;text-align:center;vertical-align:middle;font-family:system-ui}.table-body{border:1px solid #d3d7e3}.table-col-head{font-size:14px;color:#28539b;font-weight:600;width:30%}.table-col-val{font-size:14px;color:#505050;font-weight:400}.footer{padding:20px;border-top:1px solid #aebbdd;background-color:#f8fafe;border-radius:0 0 10px 10px}</style></head><body><div class=\"main-content\"><div><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tbody><tr><th colspan=\"3\" style=\"text-align:center\"><img src=\"https://cdn.shakedeal.com/images/logos/2/shakepe_logo.png\" style=\"width:20%;padding:20px\"></th></tr></tbody></table><table class=\"print-width100\"><tbody><tr><th><div style=\"border:1px solid #aebbdd;border-radius:10px\"><div class=\"content\" style=\"padding:20px\"><div><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px\"><tbody><tr><th class=\"heading-text\">Approval of Your Campaign Request</th></tr></tbody></table><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px;padding-top:30px\"><tbody><tr><th class=\"content-text\" style=\"font-weight:600\">Dear {requester_name},</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">Your campaign request for {campaign_name} has been approved by {admin_name}. Codes have been generated and are ready to download.</th></tr><tr><th>&nbsp;</th></tr><tr><th class=\"content-text\">You can access them through our portal : <a href=\"{url}\">{url}</a>.</th></tr></tbody></table></div><div style=\"padding-top:30px\"><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px\"><tbody><tr><th class=\"content-text\">Best regards,</th></tr><tr><th class=\"content-text\">Team ShakePe</th></tr></tbody></table></div></div><div class=\"footer\"><table class=\"content-table\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"padding:5px;background-color:#f8fafe\"><tbody><tr style=\"width:100%\"><th class=\"footer-text\">Need any<br><span style=\"font-weight:700\">ASSISTANCE?</span></th><th class=\"footer-text\">EMAIL<br><a href=\"mailto:support@shakepe.com\"><span style=\"color:#5fbd57\">support@shakepe.com</span></a></th><th class=\"footer-text\">CALL<br><a href=\"tel:+916366532173\"><span style=\"color:#4e6db5;font-weight:700\">+91-6366532173</span></a></th></tr></tbody></table></div></div></th></tr></tbody></table><br><br><br></div></div></body>';\n        mail_content = mail_content.replace(/{url}/g, $node[\"Webhook\"].json.body.trigger.body.config.request_link)\n                .replace(/{admin_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"admin_name\"])\n                .replace(/{requester_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"requester_name\"])\n                .replace(/{campaign_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_name\"]);\n        mailText = mail_content;\n      }\n    }\n    mailSubject=`Approval of Your Codes`+` (${$node[\"Webhook\"].json.body.trigger.body.config.request_id})`;\n    break;\n  case 6:\n    mailText=`Dear ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name},<br><br>`+\n    `We regret to inform you that your request has been reviewed by ${$node[\"Webhook\"].json.body.trigger.body.config.admin_name}, and unfortunately, it has been declined.<br><br>`+\n    `Comments: ${$node[\"Webhook\"].json.body.trigger.body.config.admin_comments}<br><br>`+\n    `If you have any questions or would like to discuss the feedback in more detail, please reach out to ${$node[\"Webhook\"].json.body.trigger.body.config.admin_name}.<br><br>`+\n    ` Best regards,<br><br>`+\n    `Team ShakePe`\n\n    if(mail_format == 'new'){\n      reject_mail_content = reject_mail_content.replace(/{approver_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"admin_name\"])\n                .replace(/{requester_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"requester_name\"])\n                .replace(/{campaign_name}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"campaign_name\"])\n                .replace(/{comments}/g, $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"admin_comments\"]);\n\n      mailText = reject_mail_content;\n    }\n    mailSubject=`Decline of New Codes Request (${$node[\"Webhook\"].json.body.trigger.body.config.request_id})`\n    break;\n  case 10:\n    mailText = `Campaign (${$node[\"Webhook\"].json.body.trigger.body.config.request_id}) Confirmation Pending: <br><br>`+\n    `The campaign has been reviewed and approved by Admin (${$node[\"Webhook\"].json.body.trigger.body.config.admin_name}). The campaign requires a final confirmation from the Ops Team.<br><br>`+\n    `Please review the campaign from portal using the link below<br>`+\n    `${$node[\"Webhook\"].json.body.trigger.body.config.request_link}<br><br>`+\n    `Best regards,<br><br>`+\n    `Team ShakePe`\n    mailSubject=`Ops Confirmation Pending: (${$node[\"Webhook\"].json.body.trigger.body.config.request_id})`\n    break;\n  case 11:\n     mailText = `Dear ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name},<br><br>`+\n    `The reward links you requested have been successfully generated and are now ready for download from the portal.<br><br>`+\n    `You can proceed with distributing these links to the intended participants to recognize and motivate them for their outstanding contributions, efforts, or achievements.<br>`+\n    `You can access them through the portal:<br>`+\n    `${$node[\"Webhook\"].json.body.trigger.body.config.request_link}<br><br>`+\n    `You can download the codes and send them across to the intended recipients to recognize and motivate them for their outstanding contributions, efforts, or achievements.<br><br>`+\n    `Best regards,<br><br>`+\n    `Team ShakePe`\n    mailSubject=`Reward Links Generated and Ready for Download : Req (${$node[\"Webhook\"].json.body.trigger.body.config.request_id})`\n    break;\n  case 12:\n    mailText=`Dear ${$node[\"Webhook\"].json.body.trigger.body.config.requester_name},<br><br>`+\n    `We regret to inform you that your request has been reviewed by Operations Team, and unfortunately, it has been declined.<br><br>`+\n    `Comments: ${$node[\"Webhook\"].json.body.trigger.body.config.ops_comments}<br><br>`+\n    ` Best regards,<br><br>`+\n    `Team ShakePe`\n    mailSubject=`Update on Your Codes Request (${$node[\"Webhook\"].json.body.trigger.body.config.request_id})`\n    break;\n  default:\n    break;\n}\n\n\nif($node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"to\"]==\"OPS_EMAIL_IDS\") {\n  $node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"config\"][\"to\"] = opsEmailAddresses;\n}\n\nitems[0].json.mailText = mailText;\nitems[0].json.mailSubject= mailSubject;\n\nreturn items;"
      },
      "name": "Function",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        700,
        260
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": true,
              "value2": "={{$node[\"Webhook\"].json[\"body\"][\"trigger\"][\"body\"][\"case\"] == 7?true:false}}"
            }
          ]
        }
      },
      "name": "IF",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        960,
        260
      ]
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "requestMethod": "POST",
        "url": "=https://qan8n.shakedeal.com/webhook/mail-icici-reward-voucher",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "={{$node[\"Webhook\"].json.body.trigger.body.config}}"
      },
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        1240,
        120
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "98",
          "name": "ICICI Mailing Credentials"
        }
      }
    }
  ],
  "settings": {},
  "staticData": null,
  "tags": [],
  "updatedAt": "2024-03-12T13:02:31.725Z"
}