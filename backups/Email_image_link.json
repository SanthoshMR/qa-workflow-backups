{
  "active": false,
  "connections": {
    "Start": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Function",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Function": {
      "main": [
        [
          {
            "node": "Item Lists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Item Lists": {
      "main": [
        [
          {
            "node": "Send Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2023-12-14T12:49:39.208Z",
  "id": "391",
  "name": "Email_image_link",
  "nodes": [
    {
      "parameters": {},
      "name": "Start",
      "type": "n8n-nodes-base.start",
      "typeVersion": 1,
      "position": [
        240,
        300
      ]
    },
    {
      "parameters": {
        "authentication": "headerAuth",
        "url": "https://campaignsqa.shakepe.com/items/sp_reward_campaigns?limit=9&fields[]=*.*",
        "options": {}
      },
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        460,
        300
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "102",
          "name": "Header Auth account 2(campaign qa)"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "\nlet arr = $node[\"HTTP Request\"].json[\"data\"];\nlet linksArray = [];\nlet y = [];\n\nfor (let i = 0; i < arr.length; i++) {\n  let name = arr[i]['name'];\n  let links = arr[i]['reward_links'];\n  let enddate = arr[i]['end_date'];\n\n  const date = new Date(enddate);\n  const options = { day: '2-digit', month: 'short', year: 'numeric' };\n  const formattedDate = date.toLocaleDateString('en-US', options);\n\n  let content_data = arr[i]['html_content'];\n\n  if (arr[i]['email_bg_image'] && arr[i]['email_bg_image']['id']) {\n    let email_img = arr[i]['email_bg_image']['id'];\n    let imageSrc = `https://campaignsqa.shakepe.com/assets/${email_img}`;\n\n    for (let j = 0; j < links.length; j++) {\n      let link = 'https://rewardlinksqa.shakepe.com/links/' + links[j].id;\n      let shakepelink = 'https://www.shakepe.com';\n      let firstName = links[j].first_name;\n\n      if (content_data !== null && typeof content_data === 'string') {\n        let content_field = content_data.replace('{{name}}', firstName)\n          .replace('{{link}}', link)\n          .replace('{{img}}', imageSrc)\n          .replace('{{shakepelink}}', shakepelink)\n          .replace('{{enddate}}', formattedDate);\n\n        let linkObj = {\n          name: firstName,\n          link: link,\n          content_field: content_field,\n          imageSrc: imageSrc,\n          shakepelink: shakepelink,\n          enddate: formattedDate\n        };\n\n        y.push(linkObj); // Push each link object into the array y\n      } else {\n        console.log('Invalid HTML content for item:', link);\n      }\n    }\n  } else {\n    console.log(\"email_bg_image or its id property is null or undefined.\");\n  }\n}\n\nreturn { y };\n\n\n"
      },
      "name": "Function",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        680,
        300
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "=y",
        "options": {}
      },
      "name": "Item Lists",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 1,
      "position": [
        900,
        300
      ]
    },
    {
      "parameters": {
        "fromEmail": "rooparajput19@gmail.com",
        "toEmail": "rooparajput19@gmail.com",
        "subject": "test",
        "html": "={{$node[\"Item Lists\"].json[\"content_field\"]}}",
        "options": {}
      },
      "name": "Send Email",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 1,
      "position": [
        1120,
        300
      ],
      "credentials": {
        "smtp": {
          "id": "103",
          "name": "SMTP account(Roopa)"
        }
      }
    }
  ],
  "settings": {},
  "staticData": null,
  "tags": [],
  "updatedAt": "2023-12-15T07:16:59.773Z"
}